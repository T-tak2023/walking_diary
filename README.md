# ウォーキング日記

## サイト概要
行き先を決めない“さまよう散歩”の記録を、メモ・写真・現在地・歩いた軌跡とともに残せるローカル保存型の Next.js 製アプリです。散歩中にひらめいた瞬間をその場で残し、後から地図で振り返れます。すべてのデータはブラウザの `localStorage` に保存され、必要に応じて JSON ファイルでバックアップ／復元できます。

## 主な機能と使い方
- **その場メモ（Pin a Moment）**: 「その場メモ」ボタンからモーダルを開き、テキストと任意の写真を入力します。保存時に現在地の取得を試み、成功すれば位置付きのメモとして記録されます。
- **写真の自動縮小**: 写真入力は `<input type="file" accept="image/*" capture="environment">` を使用。Canvas で最大辺（既定 800px、設定で変更可）まで自動縮小し、Base64 形式で保存します。
- **きっかけ（Drift Nudges）**: 「きっかけを表示」ボタンでランダムなお題をトースト表示し、散歩に小さな刺激を与えます。
- **地図表示**: Leaflet + OpenStreetMap の地図に、位置付きメモをピン表示。クリックすると内容プレビューが表示されます。
- **やさしい記録（任意）**: トグルボタンでオンにすると、20 秒ごとに現在地をサンプリングし、散歩のポリラインと概算距離（Haversine 計算）を表示・保存します。
- **日記リスト**: 日付降順のカードでメモを一覧。サムネイルと位置有無バッジを確認できます。カードをタップすると詳細モーダルを表示します。
- **JSON エクスポート／インポート**: `localStorage` の全データを JSON ファイルでダウンロード／読み込み可能です。端末間でデータを移したいときに便利です。
- **設定**: 距離単位（km／mi）と写真の縮小サイズを変更できます。

## 開発・動作確認
```bash
npm install
npm run dev
```
http://localhost:3000 にアクセスすると開発用プレビューが開きます。ビルドチェックは `npm run build` で実行できます。

## Vercel へのデプロイ手順（初心者向け）
1. GitHub にこのリポジトリをプッシュします。GitHub の使い方が初めての場合は、`git init` → `git add .` → `git commit -m "first commit"` → `git remote add origin <YOUR_REPO_URL>` → `git push -u origin main` の順で実行します。
2. [Vercel](https://vercel.com/) にアクセスしてログイン／サインアップします。
3. ダッシュボードで **“Add New…” → “Project”** を選択し、先ほどの GitHub リポジトリを選びます。
4. フレームワークは自動的に Next.js と判定されます。追加設定は不要なので、そのまま **“Deploy”** を押します。
5. 数分でビルドとデプロイが完了します。表示された URL が公開サイトです。メモして共有しましょう。

## 位置情報の権限について
- 初めて「その場メモ」や「やさしい記録」を使用するとき、ブラウザから位置情報アクセスの許可ダイアログが表示されます。
- 許可した場合は現在地を取得して地図にピンを打ちます。拒否してもメモ自体は保存されますが、位置情報は含まれません。
- 位置取得には HTTPS 環境が必要です。ローカル開発時以外は Vercel などの HTTPS 配信された URL を利用してください。

## トラブルシューティング
- **Leaflet / react-leaflet で SSR エラーが出る**: 地図コンポーネントは `dynamic(() => import('../components/Map'), { ssr: false })` のようにクライアント側のみで読み込んでください。本リポジトリでは既に対応済みです。
- **位置取得に失敗する**: HTTPS 上でアクセスしているかを確認し、ブラウザ設定で位置情報を許可してください。端末の位置サービスが無効な場合はオンにします。
- **画像が重い／保存に時間がかかる**: 設定セクションで「画像縮小サイズ」を下げると、より軽い画像が保存されます（初期値 800px）。
- **型エラーが発生する**: Leaflet 関連の型は `@types/leaflet` が必要です。どうしても解消できない場合は、一時的に `// @ts-ignore` を付けてビルドを通し、原因を切り分けてください。

## ライセンスとクレジット
- 地図タイル: &copy; [OpenStreetMap](https://www.openstreetmap.org/copyright) contributors
- Map UI: [Leaflet](https://leafletjs.com/) / [React-Leaflet](https://react-leaflet.js.org/)

このプロジェクト自体のソースコードは MIT ライセンスで利用できます。
